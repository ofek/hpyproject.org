<!DOCTYPE html>
<html prefix="
        og: http://ogp.me/ns# article: http://ogp.me/ns/article#
    " vocab="http://ogp.me/ns" lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>hpy 0.0.3: Second public release | HPy</title>
<link href="../../../../../assets/css/rst_base.css" rel="stylesheet" type="text/css">
<link href="../../../../../assets/css/nikola_rst.css" rel="stylesheet" type="text/css">
<link href="../../../../../assets/css/code.css" rel="stylesheet" type="text/css">
<link href="../../../../../assets/css/theme.css" rel="stylesheet" type="text/css">
<link href="../../../../../assets/css/styles.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="alternate" type="application/rss+xml" title="RSS" hreflang="en" href="../../../../../rss.xml">
<link rel="canonical" href="https://hpyproject.org/blog/posts/2021/10/hpy-0.0.3-second-public-release/">
<link rel="icon" href="../../../../../favicon2.ico" sizes="16x16">
<link rel="icon" href="../../../../../favicon32x32.ico" sizes="32x32">
<!--[if lt IE 9]><script src="../../../../../assets/js/html5shiv-printshiv.min.js"></script><![endif]--><link href="https://fonts.googleapis.com/css?family=Roboto" rel="stylesheet">
<link rel="stylesheet" type="text/css" href="../../../../../assets/css/tipuesearch.css">
<meta name="author" content="fangerer">
<link rel="prev" href="../../07/hpy-0.0.2-first-public-release/" title="hpy 0.0.2: First public release" type="text/html">
<link rel="next" href="../../../2022/06/hpy-0.0.4-third-public-release/" title="hpy 0.0.4: Third public release" type="text/html">
<meta property="og:site_name" content="HPy">
<meta property="og:title" content="hpy 0.0.3: Second public release">
<meta property="og:url" content="https://hpyproject.org/blog/posts/2021/10/hpy-0.0.3-second-public-release/">
<meta property="og:description" content="HPy 0.0.3 is out! This is already HPy's second officially released version and
was again made available on PyPI.
The major highlights of this release are new API functions, new debug mode
features, an">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2021-10-22T15:00:00Z">
</head>
<body>
    <a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>
    <div id="container">
             <header id="header"><!-- Adapted from https://www.taniarascia.com/responsive-dropdown-navigation-bar --><section class="navigation"><div class="nav-container">
            <div class="brand">
                <a href="../../../../../index.html">
                    <image id="toplogo" src="../../../../../images/hpy-logo.svg" width="75px;" alt="HPy/"></image></a>
            </div>
            <nav><ul class="nav-list">
<li> <a href="https://hpy.readthedocs.io/">Dev Docs</a> </li>  
            <li> 
                <a href="#!">Blog</a>
                <ul class="nav-dropdown">
<li> <a href="../../../../../blog">Index</a> </li>  
                    <li> <a href="../../../../../categories">Tags</a> </li>  
                    <li> <a href="../../../../../archive.html">Archive by year</a> </li>  
                    <li> <a href="../../../../../rss.xml">RSS feed</a> </li>  
                </ul>
</li>

                </ul></nav><div class="nav-mobile">
                <a id="nav-toggle" href="#!"> <span></span></a>
            </div>
        </div>
    </section><div class="searchform" role="search">
                
<form class="navbar-form navbar-left" action="../../../../../search.html" role="search">
    <div class="form-group">
        <input type="text" class="form-control" id="tipue_search_input" name="q" placeholder="Searchâ€¦" autocomplete="off">
</div>
    <input type="submit" value="Local Search" style="visibility: hidden;">
</form>

            </div>
    </header><main id="content"><article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article"><div class="post">
          <header><h1 class="p-name entry-title" itemprop="headline name"><a href="." class="u-url">hpy 0.0.3: Second public release</a></h1>

        <div class="metadata">
            <p class="byline author vcard p-author h-card"><span class="byline-name fn p-name" itemprop="author">
                    <a class="u-url" href="../../../../../authors/fangerer/">fangerer</a>
            </span></p>
            <p class="dateline">
            <a href="." rel="bookmark">
            <time class="published dt-published" datetime="2021-10-22T15:00:00Z" itemprop="datePublished" title="2021-10-22 15:00">2021-10-22 15:00</time></a>
            </p>
                <p class="commentline">            <a href="#utterances-thread">Comments</a>


            
        </p>
</div>
        
    </header><div class="e-content entry-content" itemprop="articleBody text">
      <p>HPy 0.0.3 is out! This is already HPy's second officially released version and
was again made available on PyPI.</p>
<p>The major highlights of this release are new API functions, new debug mode
features, and Windows support.</p>
<!--TEASER_END-->

<h2>What is HPy?</h2>
<p>HPy provides a new API for extending Python in C. In other words, you use
<code>#include &lt;hpy.h&gt;</code> instead of <code>#include &lt;Python.h&gt;</code>. For more info, look at
the
<a href="https://docs.hpyproject.org/en/latest/overview.html">official documentation</a>.</p>
<h2>Installation</h2>
<p>HPy 0.0.3 is best tested on Linux systems but there is also initial support for
Windows (both <code>x86_64</code>).
For CPython, you need to install it manually, using pip:</p>
<div class="code"><pre class="code literal-block">$ pip install <span class="nv">hpy</span><span class="o">==</span><span class="m">0</span>.0.3
</pre></div>


<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Currently, we provide only the <code>sdist</code> (i.e., the <code>.tar.gz</code>, no binary
wheels). But we plan to ship binary wheels starting with the next release.</p>
</div>
<p><a href="https://pypy.org">PyPy</a> and <a href="https://graalvm.org/python/">GraalPython</a> already
come with intrinsic HPy support, so no installation is necessary. HPy 0.0.3 is
included in the current releases of both, i.e. PyPy 7.3.6 (released on 
2021-10-17) and GraalPython 21.3.0 (released on 2021-10-19).</p>
<p>To double check the version of HPy which is shipped with those, you can either
use <code>pip</code> or <code>hpy.universal.get_version()</code>:</p>
<div class="code"><pre class="code literal-block"><span class="err">$</span> <span class="n">pypy</span> <span class="o">-</span><span class="n">m</span> <span class="n">pip</span> <span class="n">show</span> <span class="n">hpy</span>
<span class="n">Name</span><span class="p">:</span> <span class="n">hpy</span>
<span class="n">Version</span><span class="p">:</span> <span class="mf">0.0.3</span>
<span class="o">...</span>

<span class="err">$</span> <span class="n">graalpython</span> <span class="o">-</span><span class="n">m</span> <span class="n">pip</span> <span class="n">show</span> <span class="n">hpy</span>
<span class="n">Name</span><span class="p">:</span> <span class="n">hpy</span>
<span class="n">Version</span><span class="p">:</span> <span class="mf">0.0.3</span>
<span class="o">...</span>

<span class="err">$</span> <span class="n">pypy</span> <span class="o">-</span><span class="n">c</span> <span class="s1">'import hpy.universal; print(hpy.universal.get_version()[0])'</span>
<span class="mf">0.0.3</span>

<span class="err">$</span> <span class="n">graalpython</span> <span class="o">-</span><span class="n">c</span> <span class="s1">'import hpy.universal; print(hpy.universal.get_version()[0])'</span>
<span class="mf">0.0.3</span>
</pre></div>


<h2>API</h2>
<p>HPy is still under heavy development and does not yet provide as many API
functions as Python's C API, but more and more pieces are being added.
In this release, we've added following functions:</p>
<ul>
<li><code>HPy_Is</code></li>
<li><code>HPyBytes_FromStringAndSize</code></li>
<li><code>HPyErr_NewException</code></li>
<li><code>HPyErr_NewExceptionWithDoc</code></li>
<li><code>HPyUnicode_AsUTF8AndSize</code></li>
<li><code>HPyUnicode_DecodeFSDefault</code></li>
<li><code>HPyImport_ImportModule</code></li>
</ul>
<p>All of the above functions except of <code>HPy_Is</code> have equivalents in the C API. You
just need to remove the leading <code>H</code> from the name.</p>
<p>Function <code>HPy_Is</code> was added to be able to do object identity comparisons. In the
C API, you would just do a pointer comparison like this:</p>
<div class="code"><pre class="code literal-block"><span class="nv">PyObject</span><span class="w"> </span><span class="o">*</span><span class="nv">object_a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="cm">/* ... */</span><span class="c1">;</span><span class="w"></span>
<span class="nv">PyObject</span><span class="w"> </span><span class="o">*</span><span class="nv">object_b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="cm">/* ... */</span><span class="c1">;</span><span class="w"></span>
<span class="k">return</span><span class="w"> </span><span class="nv">object_a</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nv">object_b</span><span class="c1">;</span><span class="w"></span>
</pre></div>


<p>In HPy, direct comparisons of handles are forbidden by design, because distinct
handles can point to the same object. To compare objects by identity, you need
to use <code>HPy_Is</code>:</p>
<div class="code"><pre class="code literal-block"><span class="nv">HPy</span><span class="w"> </span><span class="nv">object_a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="cm">/* ... */</span><span class="c1">;</span><span class="w"></span>
<span class="nv">HPy</span><span class="w"> </span><span class="nv">object_b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="cm">/* ... */</span><span class="c1">;</span><span class="w"></span>
<span class="k">return</span><span class="w"> </span><span class="nv">HPy_Is</span><span class="ss">(</span><span class="nv">ctx</span>,<span class="w"> </span><span class="nv">object_a</span>,<span class="w"> </span><span class="nv">object_b</span><span class="ss">)</span><span class="c1">;</span><span class="w"></span>
</pre></div>


<p>We've also extended functions <code>HPyArg_Parse</code> and <code>HPyArg_ParseKeywords</code> and
added support for format specifier <code>s</code>. The new specifier converts a Python
unicode object into a C string. For example:</p>
<div class="code"><pre class="code literal-block"><span class="k">const</span><span class="w"> </span><span class="nb">char</span><span class="w"> </span><span class="o">*</span><span class="n">result</span><span class="p">;</span><span class="w"></span>
<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">HPyArg_Parse</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span><span class="w"> </span><span class="n">NULL</span><span class="p">,</span><span class="w"> </span><span class="n">args</span><span class="p">,</span><span class="w"> </span><span class="n">nargs</span><span class="p">,</span><span class="w"> </span><span class="s2">"s"</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">result</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">HPy_NULL</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
<span class="n">printf</span><span class="p">(</span><span class="s2">"result = </span><span class="si">%s</span><span class="se">\n</span><span class="s2">"</span><span class="p">,</span><span class="w"> </span><span class="n">result</span><span class="p">);</span><span class="w"></span>
</pre></div>


<p>For an overview of the current API, please refer to the public API declaration
in <a href="https://github.com/hpyproject/hpy/blob/release/0.0.3/hpy/tools/autogen/public_api.h#L107-L298"><code>public_api.h</code></a>,
which is used to autogenerate parts of the HPy code and is a reliable list of
all the supported functions.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>The HPy API is still considered in alpha status and it's subject to change
between versions.</p>
</div>
<h2>Debug Mode</h2>
<p>One of the great features of HPy is the <em>debug mode</em>. It was already introduced
a while ago (and therefore already included in release 0.0.2) but it got a new
feature that can help C extension developers a lot. HPy's debug mode is now able
to track closed handles. Previously, it was not guaranteed that accesses to
closed handles will cause a fatal error. This is because it's possible that
another object is associated with the closed handle. Then the program would just
operate on the wrong object. The new feature is able to prevent that.</p>
<h2>Examples</h2>
<p>The best way to get a glimpse of how to use HPy is to look at examples:</p>
<ul>
<li>
<p>the HPy repository contains a
    <a href="https://github.com/hpyproject/hpy/tree/release/0.0.3/proof-of-concept">"proof of concept" package</a>. 
    Make sure to checkout the branch <code>release/0.0.3</code>.</p>
</li>
<li>
<p><a href="https://github.com/hpyproject/ultrajson-hpy/tree/hpy-0.0.3"><code>ultrajson-hpy</code></a>
    is a port of the popular <code>ultrajson</code> package. Make sure to checkout the
    <code>hpy-0.0.3</code> branch.</p>
</li>
<li>
<p><a href="https://github.com/hpyproject/piconumpy/tree/hpy-0.0.3"><code>piconumpy</code></a>
    contains a very tiny implementation of an <code>array</code>-like class. Make sure to
    checkout the <code>hpy-0.0.3</code> branch.</p>
</li>
</ul>
</div>
      <aside class="postpromonav"><nav><ul class="pager hidden-print">
<li class="previous">
                <a href="../../07/hpy-0.0.2-first-public-release/" rel="prev" title="hpy 0.0.2: First public release">Previous post</a>
            </li>
            <li class="next">
                <a href="../../../2022/06/hpy-0.0.4-third-public-release/" rel="next" title="hpy 0.0.4: Third public release">Next post</a>
            </li>
        </ul></nav></aside><section class="comments hidden-print"><h2>Comments</h2>
                      <div data-title="hpy 0.0.3: Second public release" id="utterances-thread"></div>
        <script src="https://utteranc.es/client.js" repo="hpyproject/hpyproject.org" issue-term="title" label="Comments" theme="github-light" crossorigin="anonymous"></script></section>
</div>
    <div class="sidebar">
<div>
  <h2>
    The HPy blogposts
  </h2>
  <div>
    Create a guest post via a PR to the <a href="https://github.com/hpyproject/hpyproject.github.io/">source repo</a>
  </div>
</div>
    <div id="global-recent-posts">
    <h2>
      Recent Posts
    </h2>
    <ul class="post-list">
      <li>
        <a href="/blog/posts/2022/09/hpy_sprint_2022_report/" class="listtitle">HPy Sprint Status Update and Feedback Session</a>
      </li>
      <li>
        <a href="/blog/posts/2022/09/hpy_on_graal_and_mpl/" class="listtitle">HPy on GraalPy and Matplotlib/HPy</a>
      </li>
      <li>
        <a href="/blog/posts/2022/07/dusseldorf-sprint-2022/" class="listtitle">Dusseldorf PyPy/HPy/other sprint Sept 19-23, 2022</a>
      </li>
      <li>
        <a href="/blog/posts/2022/06/hpy-0.0.4-third-public-release/" class="listtitle">hpy 0.0.4: Third public release</a>
      </li>
      <li>
        <a href="/blog/posts/2021/10/hpy-0.0.3-second-public-release/" class="listtitle">hpy 0.0.3: Second public release</a>
      </li>
      <li>
        <a href="/blog/posts/2021/07/hpy-0.0.2-first-public-release/" class="listtitle">hpy 0.0.2: First public release</a>
      </li>
      <li>
        <a href="/blog/posts/2021/05/hpy-irc-moves-to-libera-chat/" class="listtitle">#hpy IRC moves to Libera.Chat</a>
      </li>
      <li>
        <a href="/blog/posts/2021/05/hpy-python-language-summit/" class="listtitle">HPy @ Python Language Summit</a>
      </li>
      <li>
        <a href="/blog/posts/2021/05/may-status-update/" class="listtitle">HPy Status Update</a>
      </li>
      <li>
        <a href="/blog/posts/2021/03/hello-hpy/" class="listtitle">Hello, HPy</a>
      </li>
    </ul>
  </div>

          <div id="global-archive-list">
          <h2>
            Archives
          </h2>
          <ul class="archive-level archive-level-1">
            <li><a class="reference" href="/2021/">2021</a> (6)
            </li>
            <li><a class="reference" href="/2022/">2022</a> (4)
            </li>
          </ul>
        </div>    </div>
</article></main><footer id="footer"><p>
</p>
<div class="myfooter">
  <div>
    <img src="../../../../../images/hpy-logo.svg" alt="PyPy Logo">
</div>
  <div class="logotext">
    Â Contents Â© 2022 <a href="mailto:hpy-dev@python.org">The HPy Team</a>
    Powered by <a href="https://getnikola.com" rel="nofollow">Nikola</a> 
  </div>
  <div style="margin-left: auto">
  <a href="../../../../../rss.xml">RSS feed</a>
</div>

            
        

    </div>
            <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js" crossorigin="anonymous"></script><script src="../../../../../assets/js/styles.js"></script></footer>
</div>
</body>
</html>
